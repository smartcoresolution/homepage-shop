<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>문의하기 | SmartCoreSolution</title>
  <meta name="description" content="스마트코어솔루션에 문의하세요">
  <link rel="stylesheet" href="/styles.css">
  <style>
    :root{
      --blue:#1a3a7e;
      --blue-300:#4a9eff;
      --border:#d7deea;
      --bg:#ffffff;
      --muted:#6b7280;
      --ok-bg:#d1e7dd; --ok-bd:#badbcc; --ok-tx:#0a3622;
      --err-bg:#f8d7da; --err-bd:#f5c2c7; --err-tx:#58151c;
    }
    *{box-sizing:border-box}
    body{margin:0; background:var(--bg); color:#222; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif}

    /* CONTAINER */
    .container{max-width:860px; margin:0 auto; padding:24px 16px}
    h1{margin:18px 0 8px 0; font-size:28px}
    p.desc{margin:0 0 18px 0; color:var(--muted)}
    .card{background:#f8f9fa; border:1px solid #e9ecef; border-radius:16px; padding:24px; box-shadow:0 4px 20px rgba(0,0,0,.06)}
    /* FORM */
    .grid{display:grid; grid-template-columns:1fr 1fr; gap:16px}
    .field{display:flex; flex-direction:column; gap:6px}
    .full{grid-column:1 / -1}
    label{font-weight:700; font-size:13px}
    label.required::after{content:" *"; color:#dc2626}
    input, select, textarea{padding:11px 12px; border:2px solid #dee2e6; border-radius:10px; background:#fff; font-size:14px; transition:all .2s}
    input:focus, select:focus, textarea:focus{border-color:var(--blue-300); box-shadow:0 0 0 3px rgba(74,158,255,.12); outline:none}
    textarea{min-height:140px; resize:vertical}
    .privacy{margin-top:14px; padding:12px; background:#eef2f7; border-radius:12px; display:flex; gap:10px; align-items:flex-start}
    .actions{display:flex; gap:12px; justify-content:flex-end; align-items:center; margin-top:16px}
    button{background:var(--blue); color:#fff; border:none; border-radius:999px; padding:12px 20px; font-weight:800; letter-spacing:.2px; cursor:pointer}
    button:disabled{opacity:.6; cursor:not-allowed}
    .msg{display:none; margin-top:14px; padding:12px; border-radius:12px}
    .msg.ok{display:block; background:var(--ok-bg); color:var(--ok-tx); border:1px solid var(--ok-bd)}
    .msg.err{display:block; background:var(--err-bg); color:var(--err-tx); border:1px solid var(--err-bd)}
    .note{font-size:12px; color:var(--muted)}
    @media (max-width:768px){
      .grid{grid-template-columns:1fr}
      .actions{flex-direction:column; align-items:stretch}
      button{width:100%}
      
      /* 모바일 최적화 */
      .container{padding:16px 12px}
      .card{padding:20px 16px}
      h1{font-size:24px}
      input, select, textarea{font-size:16px} /* iOS 줌 방지 */
      .privacy{flex-direction:column; gap:8px}
    }
    
    /* 모바일 터치 최적화 */
    @media (hover: none) and (pointer: coarse) {
      button, .pill, input, select, textarea {
        min-height: 44px; /* 터치 타겟 최소 크기 */
      }
      
      .dropdown .menu {
        min-width: 250px; /* 모바일에서 더 넓게 */
      }
      
      /* 모바일에서 폼 제출 버튼 강조 */
      #submitBtn {
        font-size: 16px;
        padding: 16px 24px;
        background: linear-gradient(135deg, #1a3a7e 0%, #4a9eff 100%);
        box-shadow: 0 4px 12px rgba(26, 58, 126, 0.3);
      }
      
      #submitBtn:active {
        transform: scale(0.98);
        box-shadow: 0 2px 8px rgba(26, 58, 126, 0.4);
      }
    }
    
    /* 모바일에서 오류 메시지 가독성 향상 */
    @media (max-width: 768px) {
      .msg {
        font-size: 14px;
        line-height: 1.5;
        padding: 16px;
        margin-top: 20px;
      }
      
      .msg.err {
        background: #fef2f2;
        border-color: #fecaca;
        color: #dc2626;
      }
      
      .msg.ok {
        background: #f0fdf4;
        border-color: #bbf7d0;
        color: #16a34a;
      }
    }
    footer{border-top:1px solid #eef2f7; margin-top:24px; padding:16px; text-align:center; color:#6b7280; font-size:13px}

    /* 드롭다운 메뉴 스타일 */
    .dropdown {
      position: relative;
      display: inline-block;
    }

    .dropbtn {
      background: none;
      border: none;
      color: inherit;
      font: inherit;
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 6px;
      transition: all 0.3s ease;
    }

    .dropbtn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .dropdown-content {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      background: white;
      min-width: 250px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      z-index: 1000;
      overflow: hidden;
    }

    .dropdown-content a {
      color: #374151;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      transition: all 0.2s ease;
      border-bottom: 1px solid #f3f4f6;
    }

    .dropdown-content a:last-child {
      border-bottom: none;
    }

    .dropdown-content a:hover {
      background: #f8fafc;
      color: #4a9eff;
    }

    .dropdown-content a strong {
      color: #1f2937;
      font-weight: 600;
    }

    .caret {
      margin-left: 6px;
      transition: transform 0.3s ease;
    }

    .dropdown[aria-expanded="true"] .caret {
      transform: rotate(180deg);
    }
  </style>
</head>
<body>
  <!-- NAV -->
  <nav>
    <div class="nav-inner">
      <div class="brand">
        <img src="/icons/icon-192.png" alt="SCS">
        <div class="title">SmartCoreSolution, Inc.</div>
      </div>
      <div class="menu">
        <a href="/index.html">홈</a>
        <div class="dropdown" id="svcDropdown">
          <button class="dropbtn" aria-haspopup="true" aria-expanded="false" aria-controls="svcSubmenu">
            서비스 <span class="caret" aria-hidden="true">▼</span>
          </button>
          <div class="dropdown-content" id="svcSubmenu" role="menu">
            <a role="menuitem" href="/services.html"><strong>서비스 전체 보기</strong></a>
            <div style="height:1px;background:#e5eaf3;margin:4px 0;"></div>
            <a role="menuitem" href="/healthcare-diagnosis.html">정신 건강·인지 기능 진단</a>
            <a role="menuitem" href="/healthcare-emr.html">의료 기록 자동화</a>
            <a role="menuitem" href="/healthcare-rehab.html">재활 치료·의료 통역</a>
          </div>
        </div>
        <a href="/manufacturing.html">스마트제조</a>
        <a href="/contact.html">문의</a>
        <a href="/admin-announcements.html">공지사항등록</a>
      </div>
    </div>
  </nav>

  <div class="container">
    <h1>문의하기</h1>

    <div class="card">
      <!-- ✅ AJAX 제출 (SPA 안전) -->
      <form id="contactForm" novalidate>
        <!-- FormSubmit 옵션 (본문 JSON으로 함께 전송) -->
        <input type="hidden" name="_subject" value="스마트코어솔루션 문의">
        <input type="hidden" name="_template" value="table">
        <input type="hidden" name="_captcha" value="false">
        <input type="hidden" name="_autoresponse" value="문의해 주셔서 감사합니다. 확인 후 회신드리겠습니다.">
        <input type="text" name="_honey" style="display:none" tabindex="-1" autocomplete="off">

        <div class="grid">
          <div class="field">
            <label for="name" class="required">이름</label>
            <input id="name" name="name" type="text" placeholder="홍길동" required>
          </div>

          <div class="field">
            <label for="email" class="required">보내는사람 이메일</label>
            <input id="email" name="email" type="email" placeholder="you@example.com" required>
          </div>

          <div class="field">
            <label for="phone">연락처</label>
            <input id="phone" name="phone" type="tel" placeholder="010-1234-5678">
          </div>

          <div class="field">
            <label for="inquiry_type" class="required">문의 유형</label>
            <select id="inquiry_type" name="inquiry_type" required>
              <option value="">선택해주세요</option>
              <option>헬스케어 서비스</option>
              <option>스마트제조 서비스</option>
              <option>제휴 문의</option>
              <option>강의 문의</option>
              <option>기술 문의</option>
              <option>가격 문의</option>
              <option>기타</option>
            </select>
          </div>

          <div class="field full">
            <label for="subject" class="required">제목</label>
            <input id="subject" name="subject" type="text" placeholder="문의 제목을 입력하세요" required>
          </div>

          <div class="field full">
            <label for="message" class="required">내용</label>
            <textarea id="message" name="message" placeholder="문의 내용을 자세히 적어주세요." required></textarea>
          </div>
        </div>

        <div class="privacy">
          <input type="checkbox" id="privacy" required>
          <label for="privacy" class="note">개인정보 수집·이용에 동의합니다. (문의 응대 목적)</label>
        </div>

        <div class="actions">
          <span class="note">* 표시는 필수 입력</span>
          <button id="submitBtn" type="submit">보내기</button>
        </div>

        <div id="msg" class="msg" role="status" aria-live="polite"></div>
        

      </form>
      
      <!-- 연락처 정보 -->
      <div style="margin-top: 24px; padding: 20px; background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 12px; text-align: center;">
        <h3 style="margin: 0 0 12px 0; color: var(--blue); font-size: 18px;">연락처</h3>
        <div style="display: flex; flex-direction: column; gap: 8px; align-items: center;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <span style="font-weight: 600; color: var(--muted);">FAX:</span>
            <span style="color: #333;">0504-081-2473</span>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <span style="font-weight: 600; color: var(--muted);">Email:</span>
            <span style="color: #333;">jangck11@naver.com</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>SmartCoreSolution, Inc. © 2025 · Privacy · Terms</footer>

  <script>
    // AJAX 제출
    (function(){
      const form = document.getElementById('contactForm');
      const btn  = document.getElementById('submitBtn');
      const msg  = document.getElementById('msg');

      function show(type, text){
        msg.className = 'msg ' + (type === 'ok' ? 'ok' : 'err');
        msg.textContent = text;
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault(); // SPA 라우터/페이지 전환 방지

        // 기본 HTML5 검증
        if (!form.checkValidity()) {
          show('err', '필수 입력을 확인해 주세요.');
          return;
        }
        // 이메일 형식 검증
        const email = document.getElementById('email').value.trim();
        if (!/^([^\s@]+)@([^\s@]+)\.[^\s@]+$/.test(email)) {
          show('err', '올바른 이메일 주소를 입력해 주세요.');
          return;
        }
        // 개인정보 동의
        if (!document.getElementById('privacy').checked) {
          show('err', '개인정보 수집·이용에 동의해 주세요.');
          return;
        }

        const data = Object.fromEntries(new FormData(form).entries());

        btn.disabled = true;
        btn.textContent = '전송 중...';
        show('ok', '문의사항을 전송하고 있습니다. 잠시만 기다려주세요...');
        try {
          console.log('문의사항 전송 시작:', data);
          
          // FormSubmit 서비스로 전송 시도
          let res = await fetch('https://formsubmit.co/ajax/jangck11@smartcoresolution.com', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
            body: JSON.stringify(data)
          });
          
          // FormSubmit 실패 시 대안 방법 시도
          if (!res.ok || res.status >= 400) {
            console.log('FormSubmit 실패, 대안 방법 시도...');
            
            // 응답 텍스트 확인
            let responseText = '';
            try {
              responseText = await res.text();
              console.log('FormSubmit 응답 텍스트:', responseText);
            } catch (e) {
              console.log('응답 텍스트 읽기 실패:', e);
            }
            
            // "activation needed" 오류인 경우 대안 방법 사용
            if (responseText.includes('activation') || responseText.includes('activate')) {
              console.log('FormSubmit 활성화 필요, 대안 방법 사용');
              
              // 이메일 링크로 대체 (mailto:)
              const emailSubject = encodeURIComponent(`[문의] ${data.subject || '스마트코어솔루션 문의'}`);
              const emailBody = encodeURIComponent(`
문의자: ${data.name}
이메일: ${data.email}
연락처: ${data.phone || '없음'}
문의유형: ${data.inquiry_type}
제목: ${data.subject}
내용: ${data.message}
              `);
              
              const mailtoLink = `mailto:jangck11@smartcoresolution.com?subject=${emailSubject}&body=${emailBody}`;
              
              // 사용자에게 대안 방법 안내
              show('ok', 'FormSubmit 서비스가 아직 활성화되지 않았습니다. 이메일 앱을 통해 문의사항을 보내드리겠습니다.');
              
              setTimeout(() => {
                window.location.href = mailtoLink;
              }, 2000);
              
              return;
            }
            
            // 기타 오류의 경우 일반적인 대안 방법
            show('err', `FormSubmit 서비스 오류 (${res.status}). 잠시 후 다시 시도해주세요.`);
            return;
          }
          
          console.log('응답 상태:', res.status, res.statusText);
          console.log('응답 헤더:', Object.fromEntries(res.headers.entries()));
          
          if (!res.ok) {
            throw new Error(`HTTP ${res.status}: ${res.statusText}`);
          }
          
          const json = await res.json();
          console.log('응답 데이터:', json);
          
          // FormSubmit 응답 처리 개선
          if (json) {
            console.log('FormSubmit 응답 상세:', json);
            
            // 다양한 성공 응답 형태 처리
            if (json.success === 'true' || json.success === true || json.status === 'success') {
              show('ok', '문의사항이 성공적으로 전송되었습니다!');
              setTimeout(() => {
                location.assign('/thank_you.html');
              }, 2000);
            } else if (json.message) {
              // 서버에서 오류 메시지를 보낸 경우
              show('err', `전송 실패: ${json.message}`);
            } else {
              // 응답은 있지만 성공/실패 상태가 명확하지 않은 경우
              console.warn('응답 상태가 명확하지 않음:', json);
              show('ok', '문의사항이 전송되었습니다. 확인 후 연락드리겠습니다.');
              setTimeout(() => {
                location.assign('/thank_you.html');
              }, 2000);
            }
          } else {
            // 응답 데이터가 없는 경우
            console.error('FormSubmit 응답 데이터 없음');
            show('err', '서버 응답을 받지 못했습니다. 잠시 후 다시 시도해주세요.');
          }
        } catch (err) {
          console.error('문의사항 전송 오류:', err);
          
          // 구체적인 오류 메시지 제공
          let errorMessage = '전송 실패';
          
          if (err.name === 'TypeError' && err.message.includes('fetch')) {
            errorMessage = '네트워크 연결을 확인해주세요.';
          } else if (err.name === 'SyntaxError') {
            errorMessage = '서버 응답을 처리할 수 없습니다.';
          } else if (err.message.includes('Failed to fetch')) {
            errorMessage = '인터넷 연결을 확인해주세요.';
          } else if (err.message.includes('NetworkError')) {
            errorMessage = '네트워크 오류가 발생했습니다.';
          } else {
            errorMessage = `전송 실패: ${err.message}`;
          }
          
          show('err', errorMessage);
        } finally {
          btn.disabled = false;
          btn.textContent = '보내기';
        }
      });
    })();

    // 드롭다운 메뉴 기능
    document.addEventListener('DOMContentLoaded', function() {
      const dropdown = document.getElementById('svcDropdown');
      const submenu = document.getElementById('svcSubmenu');
      
      if (dropdown && submenu) {
        // 드롭다운 버튼 클릭 시 메뉴 토글
        dropdown.addEventListener('click', function(e) {
          // 링크가 아닌 버튼 영역만 클릭했을 때만 preventDefault
          if (e.target.tagName !== 'A') {
            const isExpanded = dropdown.getAttribute('aria-expanded') === 'true';
            dropdown.setAttribute('aria-expanded', !isExpanded);
            submenu.style.display = isExpanded ? 'none' : 'block';
          }
        });

        // 드롭다운 메뉴 내 링크 클릭 시 메뉴 닫기
        submenu.addEventListener('click', function(e) {
          if (e.target.tagName === 'A') {
            // 링크 클릭 시 드롭다운 메뉴 닫기
            dropdown.setAttribute('aria-expanded', 'false');
            submenu.style.display = 'none';
          }
        });

        // 외부 클릭 시 드롭다운 닫기
        document.addEventListener('click', function(e) {
          if (!dropdown.contains(e.target)) {
            dropdown.setAttribute('aria-expanded', 'false');
            submenu.style.display = 'none';
          }
        });
      }
    });
  </script>
</body>
</html>
