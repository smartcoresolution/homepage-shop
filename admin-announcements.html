<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Í≥µÏßÄÏÇ¨Ìï≠ Í¥ÄÎ¶¨ | Ïä§ÎßàÌä∏ÏΩîÏñ¥ÏÜîÎ£®ÏÖò</title>
  <meta name="description" content="Í≥µÏßÄÏÇ¨Ìï≠ÏùÑ Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî">
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#0a487c">
  <link rel="icon" href="/icons/icon-192.png">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <link rel="stylesheet" href="/styles.css">
  
  <!-- Firebase SDK Ï∂îÍ∞Ä -->
  <script type="module">
    // Firebase ÏÑ§Ï†ï (Ïó¨Í∏∞Ïóê Î≥∏Ïù∏Ïùò firebaseConfig Ï†ïÎ≥¥Î•º ÎÑ£Ïñ¥Ï£ºÏÑ∏Ïöî)
    const firebaseConfig = {
      apiKey: "YAIzaSyAvv3evd-7vc6f7pPmD6mEFlEkbe_1FeC",
      authDomain: "smartcore-announcements.firebaseapp.com",
      projectId: "smartcore-announcements",
      storageBucket: "smartcore-announcements.firebasestorage.app",
      messagingSenderId: "221896203183",
      appId: "1:221896203183:web:320176ba4c1bf52f892d5a"
    };

    // Firebase Ï¥àÍ∏∞Ìôî
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
         import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, orderBy, query, serverTimestamp, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
 

         const app = initializeApp(firebaseConfig);
     const db = getFirestore(app);
         // Ï†ÑÏó≠ Î≥ÄÏàòÎ°ú Firebase Ïù∏Ïä§ÌÑ¥Ïä§ Ï†úÍ≥µ
    window.db = db;
    window.collection = collection;
    window.addDoc = addDoc;
    window.getDocs = getDocs;
    window.deleteDoc = deleteDoc;
    window.updateDoc = updateDoc;
    window.doc = doc;
    window.getDoc = getDoc;
    window.orderBy = orderBy;
    window.query = query;
    window.serverTimestamp = serverTimestamp;
  </script>
  
  <style>
    body {
      background: #f8f9fa;
      color: #333333;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    .admin-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    
    .admin-header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .admin-title {
      font-size: 32px;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 16px;
    }
    
    .admin-description {
      font-size: 16px;
      color: #666666;
      line-height: 1.6;
    }
    
    .admin-nav {
      background: #ffffff;
      border: 1px solid #e9ecef;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .admin-nav-tabs {
      display: flex;
      gap: 16px;
      border-bottom: 1px solid #e9ecef;
      margin-bottom: 20px;
    }
    
    .admin-nav-tab {
      padding: 12px 24px;
      background: transparent;
      border: none;
      border-bottom: 3px solid transparent;
      color: #6c757d;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .admin-nav-tab.active {
      color: #4a9eff;
      border-bottom-color: #4a9eff;
    }
    
    .admin-nav-tab:hover {
      color: #4a9eff;
    }
    
    .admin-content {
      background: #ffffff;
      border: 1px solid #e9ecef;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .admin-section {
      display: none;
    }
    
    .admin-section.active {
      display: block;
    }
    
    /* Í≥µÏßÄÏÇ¨Ìï≠ Îì±Î°ù Ìèº */
    .announcement-form {
      display: grid;
      gap: 24px;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .form-group label {
      font-weight: 600;
      color: #333;
      font-size: 14px;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      padding: 14px 16px;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      font-size: 14px;
      background: #ffffff;
      color: #333333;
      transition: all 0.3s ease;
      width: 100%;
      box-sizing: border-box;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      border-color: #4a9eff;
      box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.1);
      outline: none;
    }
    
    .form-group textarea {
      resize: vertical;
      min-height: 120px;
    }
    
    .form-group small {
      font-size: 12px;
      color: #6c757d;
      font-style: italic;
      margin-top: 4px;
    }
    
    /* ÌååÏùº ÏóÖÎ°úÎìú */
    .file-upload-container {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      border: 2px dashed #dee2e6;
      border-radius: 8px;
      background: #f8f9fa;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      min-height: 60px;
    }
    
    .file-upload-container:hover {
      border-color: #4a9eff;
      background: #f0f8ff;
      box-shadow: 0 2px 8px rgba(74, 158, 255, 0.1);
    }
    
    .file-upload-container::before {
      content: 'üìÅ';
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 20px;
      opacity: 0.6;
    }
    
    .file-select-btn {
      background: #4a9eff;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 10px 20px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-left: 40px;
    }
    
    .file-select-btn:hover {
      background: #e9ecef;
      border-color: #adb5bd;
    }
    
    .file-info {
      color: #6c757d;
      font-size: 14px;
      margin-left: 12px;
      flex: 1;
    }
    
    /* Ìèº Ïï°ÏÖò */
    .form-actions {
      display: flex;
      gap: 16px;
      justify-content: center;
      margin-top: 32px;
      padding-top: 24px;
      border-top: 1px solid #e9ecef;
    }
    
    .submit-button {
      background: #4a9eff;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 16px 32px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .submit-button:hover {
      background: #3a8eff;
      transform: translateY(-1px);
      box-shadow: 0 8px 25px rgba(74, 158, 255, 0.3);
    }
    
    .cancel-button {
      background: transparent;
      color: #6c757d;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      padding: 16px 32px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .cancel-button:hover {
      background: #f8f9fa;
      border-color: #adb5bd;
    }
    
    /* Í≥µÏßÄÏÇ¨Ìï≠ Î™©Î°ù */
    .announcements-list {
      display: grid;
      gap: 16px;
    }
    
    .announcement-item {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .announcement-info {
      flex: 1;
    }
    
    .announcement-title {
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 4px;
    }
    
    .announcement-meta {
      display: flex;
      gap: 16px;
      font-size: 12px;
      color: #6c757d;
    }
    
    .announcement-actions {
      display: flex;
      gap: 8px;
    }
    
    .action-btn {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .edit-btn {
      background: #ffc107;
      color: #212529;
    }
    
    .edit-btn:hover {
      background: #e0a800;
    }
    
    .delete-btn {
      background: #dc3545;
      color: white;
    }
    
    .delete-btn:hover {
      background: #c82333;
    }
    
    /* ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò */
    .nav-bar {
      background: #ffffff;
      border-bottom: 1px solid #e9ecef;
      padding: 16px 0;
      margin-bottom: 20px;
    }
    
    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
    }
    
    .nav-title {
      font-size: 18px;
      font-weight: 600;
      color: #333;
    }
    
    .nav-back {
      color: #4a9eff;
      text-decoration: none;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .nav-back:hover {
      text-decoration: underline;
    }
    
    .nav-actions {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .logout-button {
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .logout-button:hover {
      background: #c82333;
      transform: translateY(-1px);
    }
    
    /* Î°úÍ∑∏Ïù∏ Î™®Îã¨ Ïä§ÌÉÄÏùº */
    .login-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .login-modal {
      background: white;
      border-radius: 12px;
      padding: 30px;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    
    .login-modal-header {
      text-align: center;
      margin-bottom: 24px;
    }
    
    .login-modal-header h2 {
      color: #1a1a1a;
      margin-bottom: 8px;
      font-size: 24px;
    }
    
    .login-modal-header p {
      color: #666666;
      font-size: 14px;
      line-height: 1.5;
    }
    
    .login-form {
      display: grid;
      gap: 20px;
    }
    
    .login-actions {
      display: flex;
      gap: 12px;
      margin-top: 8px;
    }
    
    .login-button {
      background: #4a9eff;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      flex: 1;
    }
    
    .login-button:hover {
      background: #3a8eff;
      transform: translateY(-1px);
    }
    
    .login-actions .cancel-button {
      background: transparent;
      color: #6c757d;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      flex: 1;
    }
    
    .login-actions .cancel-button:hover {
      background: #f8f9fa;
      border-color: #adb5bd;
    }
    
    /* Î∞òÏùëÌòï */
    @media (max-width: 768px) {
      .admin-container {
        padding: 20px 16px;
      }
      
      .admin-content {
        padding: 20px;
      }
      
      .admin-nav-tabs {
        flex-direction: column;
        gap: 8px;
      }
      
      .form-actions {
        flex-direction: column;
      }
      
      .submit-button,
      .cancel-button {
        width: 100%;
      }
      
      .announcement-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }
      
      .announcement-actions {
        width: 100%;
        justify-content: flex-end;
      }
      
      .login-modal {
        padding: 20px;
        margin: 20px;
      }
      
      .login-actions {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <!-- ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î∞î -->
  <div class="nav-bar">
    <div class="nav-container">
      <div class="nav-title">Í≥µÏßÄÏÇ¨Ìï≠ Í¥ÄÎ¶¨</div>
      <div class="nav-actions">
        <button onclick="logout()" class="logout-button">Î°úÍ∑∏ÏïÑÏõÉ</button>
      </div>
    </div>
  </div>

  <div class="admin-container">
    <div class="admin-header">
      <h1 class="admin-title">Í≥µÏßÄÏÇ¨Ìï≠ Í¥ÄÎ¶¨</h1>
      <p class="admin-description">Í≥µÏßÄÏÇ¨Ìï≠ÏùÑ Îì±Î°ùÌïòÍ≥† Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî.</p>
    </div>
    
    <div class="admin-nav">
      <div class="admin-nav-tabs">
        <button class="admin-nav-tab active" onclick="showTab('register', event)">üìù Í≥µÏßÄÏÇ¨Ìï≠ Îì±Î°ù</button>
        <button class="admin-nav-tab" onclick="showTab('manage', event)">üìã Í≥µÏßÄÏÇ¨Ìï≠ Í¥ÄÎ¶¨</button>
      </div>
    </div>
    
    <div class="admin-content">
      <!-- Í≥µÏßÄÏÇ¨Ìï≠ Îì±Î°ù ÏÑπÏÖò -->
      <div id="registerSection" class="admin-section active">
        <h3>ÏÉà Í≥µÏßÄÏÇ¨Ìï≠ Îì±Î°ù</h3>
        <form id="announcementForm" class="announcement-form">
          <div class="form-group">
            <label for="announcementTitle">Ï†úÎ™© *</label>
            <input type="text" id="announcementTitle" name="title" required placeholder="Í≥µÏßÄÏÇ¨Ìï≠ Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
          </div>
          
          <div class="form-group">
            <label for="announcementContent">ÎÇ¥Ïö© *</label>
            <textarea id="announcementContent" name="content" required placeholder="Í≥µÏßÄÏÇ¨Ìï≠ ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" rows="6"></textarea>
          </div>
          
          <div class="form-group">
            <label for="announcementPriority">Ïö∞ÏÑ†ÏàúÏúÑ</label>
            <select id="announcementPriority" name="priority">
              <option value="normal">ÏùºÎ∞ò</option>
              <option value="high">Ï§ëÏöî</option>
              <option value="urgent">Í∏¥Í∏â</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="announcementDate">ÎÇ†Ïßú</label>
            <input type="date" id="announcementDate" name="date">
          </div>
          
          <div class="form-group">
            <label for="announcementTags">ÌÉúÍ∑∏ (ÏâºÌëúÎ°ú Íµ¨Î∂Ñ)</label>
            <input type="text" id="announcementTags" name="tags" placeholder="Ïòà: Ïã†Í∑úÏÑúÎπÑÏä§, ÏóÖÎç∞Ïù¥Ìä∏, Ï†êÍ≤Ä">
          </div>
          
          <div class="form-group">
            <label for="announcementFiles">Ï≤®Î∂ÄÌååÏùº (ÏÑ†ÌÉùÏÇ¨Ìï≠)</label>
            <div class="file-upload-container">
              <input type="file" id="announcementFiles" name="files" multiple style="display: none;">
              <button type="button" class="file-select-btn" onclick="document.getElementById('announcementFiles').click()">ÌååÏùº ÏÑ†ÌÉù</button>
              <span class="file-info">ÌååÏùºÏùÑ ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò ÎìúÎûòÍ∑∏ÌïòÏó¨ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</span>
            </div>
            <small>Ïó¨Îü¨ ÌååÏùºÏùÑ ÏÑ†ÌÉùÌï† Ïàò ÏûàÏäµÎãàÎã§ ‚Ä¢ ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ÎèÑ ÏßÄÏõêÌï©ÎãàÎã§</small>
          </div>
          
          <div class="form-actions">
            <button type="button" class="submit-button" onclick="saveAnnouncements()">Ï†ÄÏû•</button>
            <button type="button" class="cancel-button" onclick="resetForm()">Ï¥àÍ∏∞Ìôî</button>
          </div>
        </form>
      </div>
      
      <!-- Í≥µÏßÄÏÇ¨Ìï≠ Í¥ÄÎ¶¨ ÏÑπÏÖò -->
      <div id="manageSection" class="admin-section">
        <h3>Îì±Î°ùÎêú Í≥µÏßÄÏÇ¨Ìï≠ Í¥ÄÎ¶¨</h3>
        <div id="announcementsList" class="announcements-list">
          <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ù Ï†ïÎ≥¥ (Ïã§Ï†ú Ïö¥ÏòÅ ÏãúÏóêÎäî ÏÑúÎ≤ÑÏóêÏÑú Í¥ÄÎ¶¨Ìï¥Ïïº Ìï®)
    const ADMIN_CREDENTIALS = {
      id: 'admin',
      password: 'admin123'
    };
    
    // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
    document.addEventListener('DOMContentLoaded', function() {
      // Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ù Ï≤¥ÌÅ¨
      if (!checkAdminAuth()) {
        showLoginModal();
        return;
      }
      
      // Ïù∏Ï¶ùÎêú Í≤ΩÏö∞ÏóêÎßå Ï¥àÍ∏∞Ìôî ÏßÑÌñâ
      initializePage();
    });
    
    // Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ù Ï≤¥ÌÅ¨
    function checkAdminAuth() {
      return sessionStorage.getItem('adminAuthenticated') === 'true';
    }
    
    // Î°úÍ∑∏Ïù∏ Î™®Îã¨ ÌëúÏãú
    function showLoginModal() {
      // Í∏∞Ï°¥ Î™®Îã¨Ïù¥ ÏûàÎã§Î©¥ Ï†úÍ±∞
      const existingModal = document.getElementById('loginModal');
      if (existingModal) {
        existingModal.remove();
      }
      
      // Î°úÍ∑∏Ïù∏ Î™®Îã¨ ÏÉùÏÑ±
      const modal = document.createElement('div');
      modal.id = 'loginModal';
      modal.innerHTML = `
        <div class="login-modal-overlay">
          <div class="login-modal">
            <div class="login-modal-header">
              <h2>üîê Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ù</h2>
              <p>Í≥µÏßÄÏÇ¨Ìï≠ Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄÏóê Ï†ëÍ∑ºÌïòÎ†§Î©¥ Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ùÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.</p>
            </div>
            <div class="login-modal-body">
              <form id="loginForm" class="login-form">
                <div class="form-group">
                  <label for="adminId">Í¥ÄÎ¶¨Ïûê ID</label>
                  <input type="text" id="adminId" name="adminId" required placeholder="Í¥ÄÎ¶¨Ïûê IDÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                </div>
                <div class="form-group">
                  <label for="adminPassword">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                  <input type="password" id="adminPassword" name="adminPassword" required placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                </div>
                <div class="login-actions">
                  <button type="submit" class="login-button">Î°úÍ∑∏Ïù∏</button>
                  <button type="button" class="cancel-button" onclick="goBackToHome()">Ï∑®ÏÜå</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      // Î°úÍ∑∏Ïù∏ Ìèº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
      document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        handleLogin();
      });
      
      // ESC ÌÇ§Î°ú Î™®Îã¨ Îã´Í∏∞
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          goBackToHome();
        }
      });
    }
    
    // Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨
    function handleLogin() {
      const adminId = document.getElementById('adminId').value;
      const adminPassword = document.getElementById('adminPassword').value;
      
      if (adminId === ADMIN_CREDENTIALS.id && adminPassword === ADMIN_CREDENTIALS.password) {
        // Ïù∏Ï¶ù ÏÑ±Í≥µ
        sessionStorage.setItem('adminAuthenticated', 'true');
        document.getElementById('loginModal').remove();
        initializePage();
        alert('Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ùÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!');
      } else {
        // Ïù∏Ï¶ù Ïã§Ìå®
        alert('ÏûòÎ™ªÎêú Í¥ÄÎ¶¨Ïûê ID ÎòêÎäî ÎπÑÎ∞ÄÎ≤àÌò∏ÏûÖÎãàÎã§.');
        document.getElementById('adminPassword').value = '';
        document.getElementById('adminPassword').focus();
      }
    }
    
    // ÌôàÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
    function goBackToHome() {
      window.location.href = '/';
    }
    
    // Î°úÍ∑∏ÏïÑÏõÉ
    function logout() {
      if (confirm('Î°úÍ∑∏ÏïÑÏõÉÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
        sessionStorage.removeItem('adminAuthenticated');
        alert('Î°úÍ∑∏ÏïÑÏõÉÎêòÏóàÏäµÎãàÎã§.');
        showLoginModal();
      }
    }
    
    // ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî (Ïù∏Ï¶ù ÌõÑ)
    function initializePage() {
      // ÎÇ†Ïßú ÌïÑÎìúÏóê Ïò§Îäò ÎÇ†Ïßú ÏÑ§Ï†ï
      document.getElementById('announcementDate').value = new Date().toISOString().split('T')[0];
      
      // ÌååÏùº ÏÑ†ÌÉù Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
      const fileInput = document.getElementById('announcementFiles');
      const fileInfo = document.querySelector('.file-info');
      const fileUploadContainer = document.querySelector('.file-upload-container');
      
      if (fileInput && fileInfo) {
        fileInput.addEventListener('change', function() {
          console.log('ÌååÏùº ÏÑ†ÌÉùÎê®:', this.files.length, 'Í∞ú ÌååÏùº');
          updateFileInfo(this.files, fileInfo);
        });
      }
      
      // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Í∏∞Îä• Ï∂îÍ∞Ä
      if (fileUploadContainer) {
        // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä (Î∞±ÏóÖ)
        fileUploadContainer.addEventListener('click', function(e) {
          if (e.target !== fileInput && e.target.tagName !== 'BUTTON') {
            console.log('ÌååÏùº ÏóÖÎ°úÎìú Ïª®ÌÖåÏù¥ÎÑà ÌÅ¥Î¶≠Îê®');
            fileInput.click();
          }
        });
        
        fileUploadContainer.addEventListener('dragover', function(e) {
          e.preventDefault();
          this.style.borderColor = '#4a9eff';
          this.style.backgroundColor = '#f0f8ff';
        });
        
        fileUploadContainer.addEventListener('dragleave', function(e) {
          e.preventDefault();
          this.style.borderColor = '#dee2e6';
          this.style.backgroundColor = 'transparent';
        });
        
        fileUploadContainer.addEventListener('drop', function(e) {
          e.preventDefault();
          this.style.borderColor = '#dee2e6';
          this.style.backgroundColor = 'transparent';
          
          if (fileInput && e.dataTransfer.files.length > 0) {
            console.log('ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ÏúºÎ°ú ÌååÏùº ÏÑ†ÌÉùÎê®:', e.dataTransfer.files.length, 'Í∞ú');
            fileInput.files = e.dataTransfer.files;
            updateFileInfo(e.dataTransfer.files, fileInfo);
          }
        });
      }
      
      // Í≥µÏßÄÏÇ¨Ìï≠ Î™©Î°ù Î°úÎìú
      loadAnnouncementsList();
    }
    
    // ÌååÏùº Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
    function updateFileInfo(files, fileInfoElement) {
      console.log('updateFileInfo Ìò∏Ï∂úÎê®:', files, fileInfoElement);
      if (files && files.length > 0) {
        const fileNames = Array.from(files).map(file => file.name).join(', ');
        const totalSize = Array.from(files).reduce((total, file) => total + file.size, 0);
        fileInfoElement.textContent = `ÏÑ†ÌÉùÎêú ÌååÏùº: ${fileNames} (Ï¥ù ${formatFileSize(totalSize)})`;
        console.log('ÌååÏùº Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å:', fileNames, formatFileSize(totalSize));
      } else {
        fileInfoElement.textContent = 'ÏÑ†ÌÉùÎêú ÌååÏùº ÏóÜÏùå';
        console.log('ÌååÏùºÏù¥ ÏÑ†ÌÉùÎêòÏßÄ ÏïäÏùå');
      }
    }
    
    // ÌååÏùº ÌÅ¨Í∏∞ Ìè¨Îß∑ÌåÖ Ìï®Ïàò
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    // ÌååÏùºÏùÑ Base64Î°ú Î≥ÄÌôòÌïòÎäî Ìï®Ïàò
    function convertFileToBase64(file) {
      return new Promise((resolve, reject) => {
        console.log('Base64 Î≥ÄÌôò ÏãúÏûë:', file.name, 'ÌÅ¨Í∏∞:', file.size, 'ÌÉÄÏûÖ:', file.type);
        
        // ÌååÏùº ÌÅ¨Í∏∞ Î∞è ÌÉÄÏûÖ Í≤ÄÏ¶ù
        if (!file || file.size === 0) {
          reject(new Error('Îπà ÌååÏùºÏûÖÎãàÎã§.'));
          return;
        }
        
        if (file.size > 500 * 1024) {
          reject(new Error(`ÌååÏùº ÌÅ¨Í∏∞Í∞Ä ÎÑàÎ¨¥ ÌÅΩÎãàÎã§: ${formatFileSize(file.size)} (ÏµúÎåÄ 500KB)`));
          return;
        }
        
        const reader = new FileReader();
        
        reader.onload = () => {
          try {
            console.log('FileReader Î°úÎìú ÏôÑÎ£å, Í≤∞Í≥º Í∏∏Ïù¥:', reader.result.length);
            
            if (!reader.result || reader.result.length === 0) {
              reject(new Error('ÌååÏùº ÏùΩÍ∏∞ Í≤∞Í≥ºÍ∞Ä ÎπÑÏñ¥ÏûàÏäµÎãàÎã§.'));
              return;
            }
            
            // data: URL ÌòïÏãù Í≤ÄÏ¶ù
            if (!reader.result.startsWith('data:')) {
              reject(new Error('ÏûòÎ™ªÎêú ÌååÏùº ÌòïÏãùÏûÖÎãàÎã§.'));
              return;
            }
            
            const base64 = reader.result.split(',')[1]; // "data:application/pdf;base64," Î∂ÄÎ∂Ñ Ï†úÍ±∞
            
            if (!base64 || base64.length === 0) {
              reject(new Error('Base64 Îç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú Ïã§Ìå®'));
              return;
            }
            
            // Base64 Îç∞Ïù¥ÌÑ∞ Ïú†Ìö®ÏÑ± Í≤ÄÏ¶ù (Í∏∞Î≥∏Ï†ÅÏù∏ Ìå®ÌÑ¥ ÌôïÏù∏)
            if (base64.length < 100) {
              reject(new Error('Base64 Îç∞Ïù¥ÌÑ∞Í∞Ä ÎÑàÎ¨¥ ÏßßÏäµÎãàÎã§.'));
              return;
            }
            
            console.log('Base64 Îç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú ÏôÑÎ£å, Í∏∏Ïù¥:', base64.length);
            console.log('Base64 Îç∞Ïù¥ÌÑ∞ ÏÉòÌîå (Ï≤òÏùå 100Ïûê):', base64.substring(0, 100));
            console.log('Base64 Îç∞Ïù¥ÌÑ∞ ÏÉòÌîå (ÎßàÏßÄÎßâ 100Ïûê):', base64.substring(base64.length - 100));
            
            // Î∞òÎ≥µÎêòÎäî Î¨∏Ïûê Ìå®ÌÑ¥ ÌôïÏù∏
            const firstChar = base64[0];
            const lastChar = base64[base64.length - 1];
            const middleChar = base64[Math.floor(base64.length / 2)];
            
            console.log('Base64 Îç∞Ïù¥ÌÑ∞ Î¨∏Ïûê Î∂ÑÌè¨ ÌôïÏù∏:', {
              Ï≤´Í∏ÄÏûê: firstChar,
              Ï§ëÍ∞ÑÍ∏ÄÏûê: middleChar,
              ÎßàÏßÄÎßâÍ∏ÄÏûê: lastChar,
              Ï†ÑÏ≤¥Í∏∏Ïù¥: base64.length
            });
            
            resolve(base64);
          } catch (error) {
            console.error('Base64 Î≥ÄÌôò Ï§ë Ïò§Î•ò:', error);
            reject(new Error('Base64 Î≥ÄÌôò Ïã§Ìå®: ' + error.message));
          }
        };
        
        reader.onerror = () => {
          console.error('FileReader Ïò§Î•ò:', reader.error);
          reject(new Error('ÌååÏùº ÏùΩÍ∏∞ Ïã§Ìå®: ' + reader.error));
        };
        
        reader.onabort = () => {
          console.error('FileReader Ï§ëÎã®Îê®');
          reject(new Error('ÌååÏùº ÏùΩÍ∏∞Í∞Ä Ï§ëÎã®ÎêòÏóàÏäµÎãàÎã§.'));
        };
        
        // ÌååÏùºÏùÑ ArrayBufferÎ°ú ÏùΩÍ∏∞ (Îçî ÏïàÏ†ïÏ†Å)
        try {
          reader.readAsDataURL(file);
        } catch (error) {
          console.error('FileReader ÏãúÏûë Ïã§Ìå®:', error);
          reject(new Error('ÌååÏùº ÏùΩÍ∏∞ ÏãúÏûë Ïã§Ìå®: ' + error.message));
        }
      });
    }
    
    // ÎåÄÏ≤¥ Base64 Î≥ÄÌôò Ìï®Ïàò (ArrayBuffer ÏÇ¨Ïö©)
    function convertFileToBase64Alternative(file) {
      return new Promise((resolve, reject) => {
        console.log('ÎåÄÏ≤¥ Base64 Î≥ÄÌôò ÏãúÏûë:', file.name);
        
        const reader = new FileReader();
        
        reader.onload = () => {
          try {
            const arrayBuffer = reader.result;
            const bytes = new Uint8Array(arrayBuffer);
            
            console.log('ArrayBuffer ÏùΩÍ∏∞ ÏôÑÎ£å, Î∞îÏù¥Ìä∏ Ïàò:', bytes.length);
            
            // Î∞îÏù¥Ìä∏Î•º Base64Î°ú Î≥ÄÌôò
            let binary = '';
            for (let i = 0; i < bytes.length; i++) {
              binary += String.fromCharCode(bytes[i]);
            }
            
            const base64 = btoa(binary);
            console.log('ÎåÄÏ≤¥ Î∞©Î≤ïÏúºÎ°ú Base64 Î≥ÄÌôò ÏôÑÎ£å, Í∏∏Ïù¥:', base64.length);
            
            resolve(base64);
          } catch (error) {
            console.error('ÎåÄÏ≤¥ Base64 Î≥ÄÌôò Ïã§Ìå®:', error);
            reject(error);
          }
        };
        
        reader.onerror = () => reject(new Error('ÌååÏùº ÏùΩÍ∏∞ Ïã§Ìå®'));
        reader.readAsArrayBuffer(file);
      });
    }
    
    // ÌÉ≠ Ï†ÑÌôò
    function showTab(tabName, event) {
      console.log('ÌÉ≠ Ï†ÑÌôò:', tabName, 'event:', event);
      
      // Î™®Îì† ÌÉ≠ ÎπÑÌôúÏÑ±Ìôî
      document.querySelectorAll('.admin-nav-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.admin-section').forEach(section => {
        section.classList.remove('active');
      });
      
      // ÏÑ†ÌÉùÎêú ÌÉ≠ ÌôúÏÑ±Ìôî (eventÍ∞Ä ÏûàÏùÑ ÎïåÎßå)
      if (event && event.target) {
        event.target.classList.add('active');
      }
      document.getElementById(tabName + 'Section').classList.add('active');
      
      // Í¥ÄÎ¶¨ ÌÉ≠Ïùº Îïå Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
      if (tabName === 'manage') {
        console.log('Í¥ÄÎ¶¨ ÌÉ≠ ÌôúÏÑ±Ìôî, Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ® ÏãúÏûë');
        loadAnnouncementsList();
      }
      
      console.log('ÌÉ≠ Ï†ÑÌôò ÏôÑÎ£å:', tabName);
    }
    
    // Í≥µÏßÄÏÇ¨Ìï≠ Ï†ÄÏû• (Firebase)
    async function saveAnnouncements() {
      const form = document.getElementById('announcementForm');
      const formData = new FormData(form);
      
      // ÌïÑÏàò ÌïÑÎìú Í≤ÄÏ¶ù
      if (!formData.get('title') || !formData.get('content')) {
        alert('Ï†úÎ™©Í≥º ÎÇ¥Ïö©ÏùÄ ÌïÑÏàò ÏûÖÎ†• Ìï≠Î™©ÏûÖÎãàÎã§.');
        return;
      }
      
      try {
        // ÌååÏùº Ï†ïÎ≥¥ ÏàòÏßë Î∞è ÏóÖÎ°úÎìú
        const fileInput = document.getElementById('announcementFiles');
        let files = [];
        
        console.log('ÌååÏùº ÏûÖÎ†• ÌïÑÎìú:', fileInput);
        console.log('ÏÑ†ÌÉùÎêú ÌååÏùºÎì§:', fileInput ? fileInput.files : 'fileInput ÏóÜÏùå');
        
        if (fileInput && fileInput.files.length > 0) {
          try {
            // ÌååÏùºÎì§ÏùÑ Base64Î°ú Î≥ÄÌôòÌïòÏó¨ FirestoreÏóê Ï†ÄÏû•
            const filePromises = Array.from(fileInput.files).map(async (file) => {
              try {
                console.log('ÌååÏùº Ï≤òÎ¶¨ ÏãúÏûë:', file.name, 'ÌÅ¨Í∏∞:', formatFileSize(file.size));
                
                // ÌååÏùº ÌÅ¨Í∏∞ Ï†úÌïú (500KB)
                if (file.size > 500 * 1024) {
                  throw new Error(`ÌååÏùº ÌÅ¨Í∏∞Í∞Ä ÎÑàÎ¨¥ ÌÅΩÎãàÎã§: ${formatFileSize(file.size)} (ÏµúÎåÄ 500KB)`);
                }
                
                // ÌååÏùºÏùÑ Base64Î°ú Î≥ÄÌôò (Ï≤´ Î≤àÏß∏ Î∞©Î≤ï)
                let base64Data;
                console.log('=== ÌååÏùº Ï≤òÎ¶¨ ÏãúÏûë ===');
                console.log('ÌååÏùº Ï†ïÎ≥¥:', {
                  name: file.name,
                  size: file.size,
                  type: file.type,
                  lastModified: file.lastModified
                });
                
                try {
                  console.log('Ï≤´ Î≤àÏß∏ Î∞©Î≤ï ÏãúÎèÑ Ï§ë...');
                  base64Data = await convertFileToBase64(file);
                  console.log('‚úÖ Ï≤´ Î≤àÏß∏ Î∞©Î≤ïÏúºÎ°ú Base64 Î≥ÄÌôò ÏôÑÎ£å:', file.name);
                  console.log('Base64 Îç∞Ïù¥ÌÑ∞ Í∏∏Ïù¥:', base64Data.length);
                  console.log('Base64 Îç∞Ïù¥ÌÑ∞ ÏÉòÌîå (Ï≤òÏùå 50Ïûê):', base64Data.substring(0, 50));
                } catch (error) {
                  console.log('‚ùå Ï≤´ Î≤àÏß∏ Î∞©Î≤ï Ïã§Ìå®:', error.message);
                  console.log('ÎåÄÏ≤¥ Î∞©Î≤ï ÏãúÎèÑ Ï§ë...');
                  try {
                    base64Data = await convertFileToBase64Alternative(file);
                    console.log('‚úÖ ÎåÄÏ≤¥ Î∞©Î≤ïÏúºÎ°ú Base64 Î≥ÄÌôò ÏôÑÎ£å:', file.name);
                    console.log('Base64 Îç∞Ïù¥ÌÑ∞ Í∏∏Ïù¥:', base64Data.length);
                    console.log('Base64 Îç∞Ïù¥ÌÑ∞ ÏÉòÌîå (Ï≤òÏùå 50Ïûê):', base64Data.substring(0, 50));
                  } catch (alternativeError) {
                    console.error('‚ùå ÎåÄÏ≤¥ Î∞©Î≤ïÎèÑ Ïã§Ìå®:', alternativeError.message);
                    throw new Error(`Î™®Îì† Base64 Î≥ÄÌôò Î∞©Î≤ï Ïã§Ìå®: ${error.message}, ${alternativeError.message}`);
                  }
                }
                
                console.log('=== ÌååÏùº Ï≤òÎ¶¨ ÏôÑÎ£å ===');
                
                return {
                  name: file.name,
                  size: file.size,
                  type: file.type,
                  lastModified: file.lastModified,
                  data: base64Data, // Base64 Îç∞Ïù¥ÌÑ∞
                  isBase64: true
                };
              } catch (fileError) {
                console.error(`ÌååÏùº ${file.name} Ï≤òÎ¶¨ Ïã§Ìå®:`, fileError);
                throw new Error(`ÌååÏùº "${file.name}" Ï≤òÎ¶¨ Ïã§Ìå®: ${fileError.message}`);
              }
            });
            
            files = await Promise.all(filePromises);
            console.log('Î™®Îì† ÌååÏùº Ï≤òÎ¶¨ ÏôÑÎ£å:', files.length, 'Í∞ú');
            console.log('ÌååÏùº Îç∞Ïù¥ÌÑ∞ ÏÉòÌîå:', files[0] ? {
              name: files[0].name,
              size: files[0].size,
              hasData: !!files[0].data,
              dataLength: files[0].data ? files[0].data.length : 0,
              isBase64: files[0].isBase64
            } : 'ÌååÏùº ÏóÜÏùå');
          } catch (uploadError) {
            console.error('ÌååÏùº Ï≤òÎ¶¨ Ïã§Ìå®:', uploadError);
            alert(`ÌååÏùº Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§:\n\n${uploadError.message}\n\nÌååÏùº ÌÅ¨Í∏∞Î•º 500KB Ïù¥ÌïòÎ°ú Ï§ÑÏó¨Î≥¥ÏÑ∏Ïöî.`);
            return;
          }
        } else {
          console.log('ÏÑ†ÌÉùÎêú ÌååÏùºÏù¥ ÏóÜÏäµÎãàÎã§.');
        }
        
        // ÏÉà Í≥µÏßÄÏÇ¨Ìï≠ ÏÉùÏÑ±
        const newAnnouncement = {
          title: formData.get('title'),
          content: formData.get('content'),
          priority: formData.get('priority') || 'normal',
          date: formData.get('date') || new Date().toISOString().split('T')[0],
          tags: formData.get('tags') ? formData.get('tags').split(',').map(tag => tag.trim()).filter(tag => tag) : [],
          files: files,
          createdAt: serverTimestamp(),
          updatedAt: serverTimestamp()
        };
        
        console.log('=== Ï†ÄÏû•Ìï† Í≥µÏßÄÏÇ¨Ìï≠ Îç∞Ïù¥ÌÑ∞ ===');
        console.log('Ï†úÎ™©:', newAnnouncement.title);
        console.log('ÌååÏùº Ïàò:', newAnnouncement.files.length);
        
        newAnnouncement.files.forEach((file, index) => {
          console.log(`ÌååÏùº ${index + 1}:`, {
            name: file.name,
            size: file.size,
            type: file.type,
            hasData: !!file.data,
            dataLength: file.data ? file.data.length : 0,
            isBase64: file.isBase64,
            dataSample: file.data ? file.data.substring(0, 100) : 'Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå'
          });
        });
        
        // FirebaseÏóê Ï†ÄÏû•
        const docRef = await addDoc(collection(db, "announcements"), newAnnouncement);
        
        console.log('Firestore Ï†ÄÏû• ÏôÑÎ£å, Î¨∏ÏÑú ID:', docRef.id);
        
        // Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
        const savedDoc = await getDoc(docRef);
        if (savedDoc.exists()) {
          const savedData = savedDoc.data();
          console.log('Ï†ÄÏû•Îêú Í≥µÏßÄÏÇ¨Ìï≠ Îç∞Ïù¥ÌÑ∞:', {
            id: savedDoc.id,
            title: savedData.title,
            filesCount: savedData.files ? savedData.files.length : 0,
            filesData: savedData.files ? savedData.files.map(f => ({
              name: f.name,
              size: f.size,
              hasData: !!f.data,
              dataLength: f.data ? f.data.length : 0,
              isBase64: f.isBase64
            })) : []
          });
        }
        
        // ÏÑ±Í≥µ Î©îÏãúÏßÄ
        alert('Í≥µÏßÄÏÇ¨Ìï≠Ïù¥ FirebaseÏóê ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
        
        // Ìèº Ï¥àÍ∏∞Ìôî
        resetForm();
        
        // Í¥ÄÎ¶¨ ÌÉ≠ÏúºÎ°ú Ïù¥Îèô
        showTab('manage', null);
        
      } catch (error) {
        console.error("Firebase Ï†ÄÏû• Ïã§Ìå®:", error);
        alert('Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
      }
    }
    
    // Ìèº Ï¥àÍ∏∞Ìôî
    function resetForm() {
      document.getElementById('announcementForm').reset();
      document.getElementById('announcementDate').value = new Date().toISOString().split('T')[0];
      
      // ÌååÏùº ÏûÖÎ†• ÌïÑÎìú Ï¥àÍ∏∞Ìôî
      const fileInput = document.getElementById('announcementFiles');
      if (fileInput) {
        fileInput.value = '';
        console.log('ÌååÏùº ÏûÖÎ†• ÌïÑÎìú Ï¥àÍ∏∞ÌôîÎê®');
      }
      
      const fileInfo = document.querySelector('.file-info');
      if (fileInfo) {
        fileInfo.textContent = 'ÌååÏùºÏùÑ ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò ÎìúÎûòÍ∑∏ÌïòÏó¨ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî';
        console.log('ÌååÏùº Ï†ïÎ≥¥ ÌÖçÏä§Ìä∏ Ï¥àÍ∏∞ÌôîÎê®');
      }
      
      // Î≤ÑÌäºÏùÑ Îì±Î°ù Î™®ÎìúÎ°ú Ï¥àÍ∏∞Ìôî
      const submitButton = document.querySelector('.submit-button');
      if (submitButton) {
        submitButton.textContent = 'Ï†ÄÏû•';
        submitButton.onclick = saveAnnouncements;
      }
    }
    
    // Í≥µÏßÄÏÇ¨Ìï≠ Î™©Î°ù Î°úÎìú (Firebase)
    async function loadAnnouncementsList() {
      const container = document.getElementById('announcementsList');
      
      try {
        // FirebaseÏóêÏÑú Í≥µÏßÄÏÇ¨Ìï≠ Î™©Î°ù Í∞ÄÏ†∏Ïò§Í∏∞
        const q = query(collection(db, "announcements"), orderBy("createdAt", "desc"));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
          container.innerHTML = `
            <div class="no-announcements">
              <p>Îì±Î°ùÎêú Í≥µÏßÄÏÇ¨Ìï≠Ïù¥ ÏóÜÏäµÎãàÎã§.</p>
            </div>
          `;
          console.log('Îì±Î°ùÎêú Í≥µÏßÄÏÇ¨Ìï≠Ïù¥ ÏóÜÏäµÎãàÎã§.');
          return;
        }
        
        const announcements = [];
        querySnapshot.forEach((doc) => {
          announcements.push({
            id: doc.id,
            ...doc.data()
          });
        });
        
        container.innerHTML = announcements.map(announcement => `
          <div class="announcement-item">
            <div class="announcement-info">
              <div class="announcement-title">${announcement.title}</div>
              <div class="announcement-meta">
                <span>Ïö∞ÏÑ†ÏàúÏúÑ: ${getPriorityText(announcement.priority)}</span>
                <span>ÎÇ†Ïßú: ${formatDate(announcement.date)}</span>
                <span>ÌÉúÍ∑∏: ${announcement.tags.join(', ') || 'ÏóÜÏùå'}</span>
              </div>
            </div>
            <div class="announcement-actions">
              <button class="action-btn edit-btn" onclick="editAnnouncement('${announcement.id}')">ÏàòÏ†ï</button>
              <button class="action-btn delete-btn" onclick="deleteAnnouncement('${announcement.id}')">ÏÇ≠Ï†ú</button>
            </div>
          </div>
        `).join('');
        
        console.log('Í≥µÏßÄÏÇ¨Ìï≠ Î™©Î°ù Î°úÎìú ÏôÑÎ£å:', announcements.length, 'Í∞ú');
        
      } catch (error) {
        console.error("Firebase Î™©Î°ù Î°úÎìú Ïã§Ìå®:", error);
        container.innerHTML = `
          <div class="no-announcements">
            <p>Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error.message}</p>
          </div>
        `;
      }
    }
    
    // Í≥µÏßÄÏÇ¨Ìï≠ ÏàòÏ†ï (Firebase)
    async function editAnnouncement(id) {
      try {
        // FirebaseÏóêÏÑú Ìï¥Îãπ Í≥µÏßÄÏÇ¨Ìï≠ Í∞ÄÏ†∏Ïò§Í∏∞
        const docRef = doc(db, "announcements", id);
        const docSnap = await getDoc(docRef);
        
        if (docSnap.exists()) {
          const announcement = docSnap.data();
          
          // Îì±Î°ù ÌÉ≠ÏúºÎ°ú Ïù¥Îèô
          showTab('register', null);
          
          // ÌèºÏóê Îç∞Ïù¥ÌÑ∞ Ï±ÑÏö∞Í∏∞
          document.getElementById('announcementTitle').value = announcement.title;
          document.getElementById('announcementContent').value = announcement.content;
          document.getElementById('announcementPriority').value = announcement.priority;
          document.getElementById('announcementDate').value = announcement.date;
          document.getElementById('announcementTags').value = announcement.tags.join(', ');
          
          // Í∏∞Ï°¥ ÌååÏùº Ï†ïÎ≥¥ ÌëúÏãú
          if (announcement.files && announcement.files.length > 0) {
            const fileInfo = document.querySelector('.file-info');
            if (fileInfo) {
              const fileNames = announcement.files.map(file => file.name).join(', ');
              const totalSize = announcement.files.reduce((total, file) => total + (file.size || 0), 0);
              fileInfo.textContent = `Í∏∞Ï°¥ ÌååÏùº: ${fileNames} (Ï¥ù ${formatFileSize(totalSize)})`;
            }
          }
          
          // ÏàòÏ†ï Î™®ÎìúÎ°ú Î≥ÄÍ≤Ω
          document.querySelector('.submit-button').textContent = 'ÏàòÏ†ï';
          document.querySelector('.submit-button').onclick = () => updateAnnouncement(id);
          
        } else {
          alert('Ìï¥Îãπ Í≥µÏßÄÏÇ¨Ìï≠ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
        }
        
      } catch (error) {
        console.error("Firebase ÏàòÏ†ï Î™®Îìú Î°úÎìú Ïã§Ìå®:", error);
        alert('ÏàòÏ†ï Î™®Îìú Î°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
      }
    }
    
    // Í≥µÏßÄÏÇ¨Ìï≠ ÏóÖÎç∞Ïù¥Ìä∏ (Firebase)
    async function updateAnnouncement(id) {
      const form = document.getElementById('announcementForm');
      const formData = new FormData(form);
      
      // ÌïÑÏàò ÌïÑÎìú Í≤ÄÏ¶ù
      if (!formData.get('title') || !formData.get('content')) {
        alert('Ï†úÎ™©Í≥º ÎÇ¥Ïö©ÏùÄ ÌïÑÏàò ÏûÖÎ†• Ìï≠Î™©ÏûÖÎãàÎã§.');
        return;
      }
      
      try {
        // ÌååÏùº Ï†ïÎ≥¥ ÏàòÏßë Î∞è ÏóÖÎ°úÎìú
        const fileInput = document.getElementById('announcementFiles');
        let files = [];
        
        if (fileInput && fileInput.files.length > 0) {
          try {
            // ÌååÏùºÎì§ÏùÑ Base64Î°ú Î≥ÄÌôò
            const filePromises = Array.from(fileInput.files).map(async (file) => {
              try {
                console.log('ÌååÏùº Ï≤òÎ¶¨ ÏãúÏûë:', file.name, 'ÌÅ¨Í∏∞:', formatFileSize(file.size));
                
                // ÌååÏùº ÌÅ¨Í∏∞ Ï†úÌïú (500KB)
                if (file.size > 500 * 1024) {
                  throw new Error(`ÌååÏùº ÌÅ¨Í∏∞Í∞Ä ÎÑàÎ¨¥ ÌÅΩÎãàÎã§: ${formatFileSize(file.size)} (ÏµúÎåÄ 500KB)`);
                }
                
                // ÌååÏùºÏùÑ Base64Î°ú Î≥ÄÌôò
                const base64Data = await convertFileToBase64(file);
                
                console.log('ÌååÏùº Base64 Î≥ÄÌôò ÏôÑÎ£å:', file.name);
                
                return {
                  name: file.name,
                  size: file.size,
                  type: file.type,
                  lastModified: file.lastModified,
                  data: base64Data, // Base64 Îç∞Ïù¥ÌÑ∞
                  isBase64: true
                };
              } catch (fileError) {
                console.error(`ÌååÏùº ${file.name} Ï≤òÎ¶¨ Ïã§Ìå®:`, fileError);
                throw new Error(`ÌååÏùº "${file.name}" Ï≤òÎ¶¨ Ïã§Ìå®: ${fileError.message}`);
              }
            });
            
            files = await Promise.all(filePromises);
            console.log('Î™®Îì† ÌååÏùº Ï≤òÎ¶¨ ÏôÑÎ£å:', files.length, 'Í∞ú');
          } catch (uploadError) {
            console.error('ÌååÏùº Ï≤òÎ¶¨ Ïã§Ìå®:', uploadError);
            alert(`ÌååÏùº Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§:\n\n${uploadError.message}\n\nÌååÏùº ÌÅ¨Í∏∞Î•º 500KB Ïù¥ÌïòÎ°ú Ï§ÑÏó¨Î≥¥ÏÑ∏Ïöî.`);
            return;
          }
        }
        
        // FirebaseÏóêÏÑú Í≥µÏßÄÏÇ¨Ìï≠ ÏóÖÎç∞Ïù¥Ìä∏
        const docRef = doc(db, "announcements", id);
        const updateData = {
          title: formData.get('title'),
          content: formData.get('content'),
          priority: formData.get('priority') || 'normal',
          date: formData.get('date') || new Date().toISOString().split('T')[0],
          tags: formData.get('tags') ? formData.get('tags').split(',').map(tag => tag.trim()).filter(tag => tag) : [],
          updatedAt: serverTimestamp()
        };
        
        // ÌååÏùºÏù¥ ÏÉàÎ°ú ÏóÖÎ°úÎìúÎêú Í≤ΩÏö∞ÏóêÎßå files ÌïÑÎìú ÏóÖÎç∞Ïù¥Ìä∏
        if (files.length > 0) {
          updateData.files = files;
        }
        
        await updateDoc(docRef, updateData);
        
        // ÏÑ±Í≥µ Î©îÏãúÏßÄ
        alert('Í≥µÏßÄÏÇ¨Ìï≠Ïù¥ FirebaseÏóê ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§!');
        
        // Ìèº Ï¥àÍ∏∞Ìôî Î∞è Îì±Î°ù Î™®ÎìúÎ°ú Î≥µÍ∑Ä
        resetForm();
        document.querySelector('.submit-button').textContent = 'Ï†ÄÏû•';
        document.querySelector('.submit-button').onclick = saveAnnouncements;
        
        // Í¥ÄÎ¶¨ ÌÉ≠ÏúºÎ°ú Ïù¥Îèô
        showTab('manage', null);
        
      } catch (error) {
        console.error("Firebase ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®:", error);
        alert('ÏàòÏ†ï Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
      }
    }
    
    // Í≥µÏßÄÏÇ¨Ìï≠ ÏÇ≠Ï†ú (Firebase)
    async function deleteAnnouncement(id) {
      if (confirm('Ï†ïÎßêÎ°ú Ïù¥ Í≥µÏßÄÏÇ¨Ìï≠ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
        try {
          // FirebaseÏóêÏÑú Í≥µÏßÄÏÇ¨Ìï≠ ÏÇ≠Ï†ú
          await deleteDoc(doc(db, "announcements", id));
          
          alert('Í≥µÏßÄÏÇ¨Ìï≠Ïù¥ FirebaseÏóêÏÑú ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
          
          // ÌòÑÏû¨ Í¥ÄÎ¶¨ ÌÉ≠Ïóê Î®∏Î¨ºÎ©¥ÏÑú Î™©Î°ùÎßå ÏÉàÎ°úÍ≥†Ïπ®
          console.log('Í≥µÏßÄÏÇ¨Ìï≠ ÏÇ≠Ï†ú ÏôÑÎ£å, Í¥ÄÎ¶¨ ÌÉ≠ÏóêÏÑú Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®');
          await loadAnnouncementsList();
          
        } catch (error) {
          console.error("Firebase ÏÇ≠Ï†ú Ïã§Ìå®:", error);
          alert('ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
        }
      }
    }
    
    // Ïö∞ÏÑ†ÏàúÏúÑ ÌÖçÏä§Ìä∏ Î≥ÄÌôò
    function getPriorityText(priority) {
      const priorityMap = {
        'normal': 'ÏùºÎ∞ò',
        'high': 'Ï§ëÏöî',
        'urgent': 'Í∏¥Í∏â'
      };
      return priorityMap[priority] || 'ÏùºÎ∞ò';
    }
    
    // ÎÇ†Ïßú Ìè¨Îß∑ÌåÖ
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('ko-KR', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit'
      });
    }
  </script>
</body>
</html>


